"""
Prompts for the 3-phase Experiment Planning Agent.
"""

PHASE1_DESIGN_PROMPT = """
あなたは生命科学実験の専門家です。
与えられた「実験指示」と「必須物品」から、実験の論理的なデザイン（Experimental Design）を抽出してください。

## 入力情報
実験指示: {instruction}
必須物品: {mandatory_objects}
元プロトコル（参考）: {source_protocol}

## タスク
実験の構成要素を論理的に整理してください。
1. **比較条件**: 何と何を比較するのか（例：濃度系列、時間経過、処理の有無）。
2. **サンプル数 (N数)**: 各条件の反復数。
3. **コントロール**: ポジティブコントロール、ネガティブコントロールの設定。
4. **必要な中間生成物**: 最終結果を得るために作成すべき中間サンプル（例：希釈系列、反応液）。

## 出力フォーマット (JSON)
{{
  "experimental_design": {{
    "conditions": ["条件A", "条件B", ...],
    "replicates": 3,
    "controls": ["Negative Control", ...],
    "sample_logic": "説明..."
  }}
}}
"""

PHASE1_OBJECTS_PROMPT = """
あなたは生命科学実験の専門家です。
「実験デザイン」と「必須物品」に基づき、この実験で使用・生成されるすべての「オブジェクト（物質、サンプル、データ）」を具体的に定義してください。

## 入力情報
実験デザイン: {experimental_design}
必須物品: {mandatory_objects}

## タスク
実験デザインを実現するために必要な物理的なオブジェクトを網羅してください。
1. **初期オブジェクト (initial)**: 実験開始時に存在する試薬、器具、サンプル。
   - 必須物品に含まれるものは必ず含める。
   - デザインに基づいて必要な容器（チューブ、プレート）も定義する。
2. **中間オブジェクト (intermediate)**: 実験操作によって生成される混合物、反応液、中間生成物。
   - デザインで定義された各条件・各サンプルに対応するオブジェクトを個別に定義する（例: sample_A_rep1, sample_A_rep2...）。
3. **最終オブジェクト (final)**: 実験の最終成果物、データ、画像、測定結果。

## 制約
- オブジェクトIDは一意で識別可能な名前にすること（ファイルパス形式推奨: objects/initial/..., objects/intermediate/...）。
- 抽象的な名前ではなく、具体的な物質名や状態を含めること。

## 出力フォーマット (JSON)
{{
  "identified_objects": {{
    "initial": ["objects/initial/reagent_A", ...],
    "intermediate": ["objects/intermediate/mix_1", ...],
    "final": ["objects/final/result_data", ...]
  }}
}}
"""

PHASE2_OP_DEF_PROMPT = """
あなたは生命科学実験の専門家です。
実験の「オブジェクトリスト」と「指示」に基づき、実験操作の流れ（オペレーション）を定義してください。

## 入力情報
実験指示: {instruction}
オブジェクトリスト: {identified_objects}
元プロトコル（参考）: {source_protocol}

## タスク
実験を構成する一連の「オペレーション」を定義してください。
各オペレーションは、入力オブジェクトを受け取り、出力オブジェクトを生成する処理です。

## 制約
- **DAG構造**: オペレーションは有向非巡回グラフ (DAG) を構成する必要があります。つまり、あるオペレーションの入力は、初期オブジェクトか、それ以前のオペレーションの出力でなければなりません。
- **網羅性**: すべての「最終オブジェクト」が生成されるように手順を組み立ててください。
- **粒度**: 1つのオペレーションは、1つの明確な化学的・物理的処理（混合、インキュベート、遠心、測定など）に対応させてください。

## 出力フォーマット
各オペレーションについて以下を指定:
- operation_id: 一意なID (例: "op_mix_reagents")
- text_description: 操作の簡潔な説明 (例: "試薬AとBを混合する")
- input: 入力オブジェクトのIDリスト
- output: 出力オブジェクトのIDリスト
"""

PHASE3_PROC_GEN_PROMPT = """
あなたは生命科学実験の専門家です。
定義された「オペレーションフロー」に基づき、学部生が実行可能な詳細な「実験手順書」を作成してください。

## 入力情報
実験指示: {instruction}
オペレーションフロー: {operations}
参考文献: {references}

## タスク
自然言語による詳細な実験手順（ステップのリスト）を生成してください。

## 制約
1. **ステップ数**: 最大50ステップ。
2. **文の長さ**: 各ステップは10文以内。
3. **詳細度**:
   - 具体的な量（µL, mL, g, mMなど）、時間、温度、回転数などを明記すること。
   - 使用する容器（1.5mLチューブ、PCRチューブなど）や器具（ピペット、遠心機）を明示すること。
   - 「適量」「しばらく」などの曖昧な表現は避け、具体的な数値を計算または推定して記述すること。
   - 暗黙の操作（チューブの蓋の開閉、ラベル貼り、混和後のスピンダウンなど）も必要に応じて記述し、初心者が迷わないようにすること。
4. **フォーマット**:
   - ステップIDは1から始まる連番。
   - テキストは日本語で記述。

## 出力例
ステップ1: 1.5 mLマイクロチューブを2本用意し、それぞれに「Sample A」「Sample B」とラベルを貼る。
ステップ2: Sample Aのチューブに、試薬X (10 mM) を 50 µL、試薬Y (5 mM) を 50 µL 加え、ボルテックスで5秒間撹拌する。
...
"""

FEEDBACK_PROMPT = """
前回の出力には以下の論理的エラー（DAG不整合など）がありました。
これらを修正して、再度オペレーションを定義してください。

## エラー内容
{feedback}

## 修正のヒント
- 入力オブジェクトが存在しない場合は、それを作成する前のステップを追加するか、初期オブジェクトを確認してください。
- 循環参照がある場合は、順序を見直してください。
- 未使用の必須オブジェクトがある場合は、それを使用するステップを追加してください。
"""
